<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-styles/default-theme.html">

<!--
A Material Design input field to enter passwords

@demo demo/index.html
-->
<dom-module id="paper-password-input">

	<template>

		<style>
			.visibility-icon {
				color: var(--disabled-text-color);
				/** Bottom align visibility button with input box */
				height: 32px;
				width: 32px;
				padding: 0 4px;
				margin-top: -6px;
			}
		</style>

		<paper-input
			id="input"
			type="[[_getType(visible)]]"
			value="{{value}}"
			label="[[label]]"
			name="[[name]]"
			maxlength="[[maxlength]]"
			disabled="[[disabled]]"
			required="[[required]]"
			autofocus="[[autofocus]]"
			auto-validate="[[autoValidate]]"
			allowed-pattern="[[allowedPattern]]"
			invalid="{{invalid}}"
			validator="[[validator]]"
			error-message="[[errorMessage]]"
			char-counter="[[charCounter]]">
			<paper-icon-button
				slot="suffix"
				icon="[[_getIcon(visible)]]"
				on-tap="_toggleVisibile"
				class="visibility-icon"
				tabindex="-1"
			></paper-icon-button>
		</paper-input>
		<template is="dom-if" if="[[showWarning]]">
			<iron-icons icon="icons:warning"></iron-icons><span>Caps lock is on</span>
		</template>
	</template>
</dom-module>

<script>

(function() {

	Polymer({
		is: 'paper-password-input',
		properties: {
			/**
			 * True if the content of the password field is visible
			 */
			visible: {
				type: Boolean,
				value: false
			},

			value: {
				type: String,
				notify: true
			},
			invalid: {
				type: Boolean,
				notify: true
			},
			label: String,
			name: String,
			showWarning: Boolean,
			disabled: Boolean,
			required: Boolean,
			autofocus: Boolean,
			autoValidate: Boolean,
			validator: String,
			errorMessage: String,
			charCounter: Boolean,
			maxlength: Number,
			allowedPattern: String
		},

		validate: function() {
			return this.$.input.validate();
		},

		_getIcon: function(visible) {
			return visible ? 'icons:visibility' : 'icons:visibility-off';
		},
		_getType: function(visible) {
			return visible ? '' : 'password';
		},
		_toggleVisibile: function() {
			this.visible = !this.visible;
		},		
		ready: function() {
        		super.ready();
        		document.addEventListener('keydown', (event) => {
			    let caps = event.getModifierState && event.getModifierState('CapsLock');
			    this.set('showWarning', caps);
			});
        	}
	});

})();

</script>
